<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecoCopula">
<title>ecoCopula package for model based ordination and graphical modelling in ecology • ecoCopula</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ecoCopula package for model based ordination and graphical modelling in ecology">
<meta property="og:description" content="ecoCopula">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecoCopula</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/ecoCopula.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>ecoCopula package for model based ordination and graphical modelling in ecology</h1>
            
      
      
      <div class="d-none name"><code>ecoCopula.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The ecoCopula package allows you to visualise multivariate discrete
data with graphical models and ordination. The package was designed
primarily for multivariate abundance data in ecology, however it can be
applied to any multivariate discrete data.</p>
<p>The two main functions are:</p>
<ol style="list-style-type: decimal">
<li>Copula ordination (<code>cord</code>) to visualise how samples
(sites) and variables (taxa) are located along several latent variables
(unobserved environmental gradient).</li>
<li>Copula graphical models (<code>cgr</code>) to plot a <em>graph</em>
which distinguishes between direct and indirect associations between
variables (e.g taxa).</li>
</ol>
<p>The ecoCopula package used model-based methods (rather than
distance-based, e.g. nMDS). Both <code>cord</code> and <code>cgr</code>
will work on either a <code>stackedsdm</code> object (stacked species
distribution model, from ecoCopula) or a <code>manyglm</code> object
(from mvabund).</p>
</div>
<div class="section level2">
<h2 id="under-the-hood">Under the hood<a class="anchor" aria-label="anchor" href="#under-the-hood"></a>
</h2>
<div class="section level3">
<h3 id="copulas-for-discrete-data">Copulas for discrete data<a class="anchor" aria-label="anchor" href="#copulas-for-discrete-data"></a>
</h3>
<p>Copulas are a way to construct a multivariate distribution, and can
be used as an alternative to hierarchical models (as in gllvm, HMSC,
boral) and generalised estimating equations (GEE; as in mvabund). Like
hierarchical models, but unlike GEEs, copulas directly model covariance
between variables (taxa). The main advantage of copulas relative to
hierarchical models is speed, with copula ordination usually being at
least 10 times faster than ordination with hierarchical models, and for
large sample sizes faster non-metric multidimensional scaling (nMDS).
For more details about copulas and how models are fit in ecoCopula see
Popovic et. al. (2018,2019).</p>
</div>
<div class="section level3">
<h3 id="copula-ordination">Copula ordination<a class="anchor" aria-label="anchor" href="#copula-ordination"></a>
</h3>
<p>Model based ordination methods, including copula ordination using the
<code>cord</code> function as well as <code>gllvm</code>,
<code>boral</code> and <code>HMSC</code>, are implemented with latent
variables. These can be interpreted as unobserved environmental
covariates. Biplots are created by plotting the scores of sites and
loadings of taxa. By directly modelling the data, model-based methods
account for both the natural variation mean-variance relationships in
multivariate abundance data. We can use standard statistical tools to
check the assumptions and perform model selection, quantify the
uncertainty in the estimated correlations between taxa, and predict to
existing and/or new sites, all of which are generally more challenging
when using dissimilarity-based ordination methods (like nMDS).</p>
</div>
<div class="section level3">
<h3 id="copula-graphical-models">Copula graphical models<a class="anchor" aria-label="anchor" href="#copula-graphical-models"></a>
</h3>
<p>Graphical models look at direct and indirect associations between
variables (taxa). They try to answer the question: <em>Is the abundance
of this pair of taxa related, after accounting for the effect of the
abundances of all the other taxa in the data?</em> A simple and crude
way to do this might be regressing each of the two taxa separately (as
response) against all the other taxa in the data (as predictors), and
then looking for any residual correlation between the pair. Graphical
models do something like this, but using modern statistical techniques
to improve efficiency and model the community jointly.</p>
<p>Install <code>ecoCopula</code> in the usual way.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ecoCopula"</span><span class="op">)</span></span></code></pre></div>
<p>Then attach the library.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eco-stats.github.io/ecoCopula/">ecoCopula</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mvabund</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hunting-spiders-counts-and-presenceabsence">Hunting spiders (counts and presence/absence)<a class="anchor" aria-label="anchor" href="#hunting-spiders-counts-and-presenceabsence"></a>
</h2>
<p>The hunting <code>spider</code> dataset (van der Aart &amp;
Smeenk-Enserink, 1975) has counts of 12 hunting spiders at 28 sites,
collected using pit traps, as well as 6 environmental covariates.
Species codes are first four letters of genus then first four letters of
species. We will analyse it both as counts and presence-absence.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># spider data is stored in ecoCopula</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">spider</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="co"># environmental covariates</span></span></code></pre></div>
<p>Counts</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span> <span class="co"># abundance of spiders</span></span>
<span><span class="va">abund</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;      Alopacce Alopcune Alopfabr Arctlute Arctperi Auloalbi</span></span>
<span><span class="co">#&gt; [1,]       25       10        0        0        0        4</span></span>
<span><span class="co">#&gt; [2,]        0        2        0        0        0       30</span></span>
<span><span class="co">#&gt; [3,]       15       20        2        2        0        9</span></span>
<span><span class="co">#&gt; [4,]        2        6        0        1        0       24</span></span>
<span><span class="co">#&gt; [5,]        1       20        0        2        0        9</span></span></code></pre></div>
<p>Presence-absence</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pa</span><span class="op">=</span><span class="op">(</span><span class="va">abund</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span> <span class="co"># presence-absence of spiders</span></span>
<span><span class="va">pa</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;      Alopacce Alopcune Alopfabr Arctlute Arctperi Auloalbi</span></span>
<span><span class="co">#&gt; [1,]        1        1        0        0        0        1</span></span>
<span><span class="co">#&gt; [2,]        0        1        0        0        0        1</span></span>
<span><span class="co">#&gt; [3,]        1        1        1        1        0        1</span></span>
<span><span class="co">#&gt; [4,]        1        1        0        1        0        1</span></span></code></pre></div>
<div class="section level3">
<h3 id="ordination">Ordination<a class="anchor" aria-label="anchor" href="#ordination"></a>
</h3>
<p>To plot an ordination biplot for presence-absence data
<code>pa</code>, we first fit a marginal model using
<code>stackedsdm</code> or <code>manyglm</code> with
<code>family="binomial"</code>, then use the copula ordination function
<code>cord</code> on the resulting object, and <code>plot</code> the
output.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit marginal model</span></span>
<span><span class="va">spider_pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedsdm.html">stackedsdm</a></span><span class="op">(</span><span class="va">pa</span>,<span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">X</span>, family<span class="op">=</span><span class="st">"binomial"</span>,ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#eqiv. manyglm()</span></span>
<span><span class="co"># fit copula ordination </span></span>
<span><span class="va">spid_lv</span><span class="op">=</span><span class="fu"><a href="../reference/cord.html">cord</a></span><span class="op">(</span><span class="va">spider_pa</span><span class="op">)</span></span>
<span><span class="co"># biplot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spid_lv</span>,biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecoCopula_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
<p>To colour the sites by a predictor, we can create a colour
variable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sand</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X</span><span class="op">$</span><span class="va">bare.sand</span><span class="op">==</span><span class="fl">0</span>,<span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spid_lv</span>,site.col <span class="op">=</span> <span class="va">sand</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecoCopula_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<p>To check that we fit a sensible model we can plot residuals
<code>plot(spider_pa)</code>. For fancier graphics with
<code>ggplot</code> see <code><a href="../reference/plot.cgr.html">?plot.cgr</a></code>.</p>
</div>
<div class="section level3">
<h3 id="graphical-model">Graphical model<a class="anchor" aria-label="anchor" href="#graphical-model"></a>
</h3>
<p>To plot a <em>graph</em> of the spider counts <code>abund</code>, we
again first fit a marginal model using <code>stackedsdm</code> or
<code>manyglm</code> with <code>family="negative.binomial"</code> (for
counts).For graphical models it makes the most sense to first control
for environmental variables, so that associations between taxa control
for those. Then we use the copula graph function <code>cgr</code> on the
resulting object, and <code>plot</code> the output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit marginal model</span></span>
<span><span class="va">spider_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedsdm.html">stackedsdm</a></span><span class="op">(</span><span class="va">abund</span>,<span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">X</span>, family<span class="op">=</span><span class="st">"negative.binomial"</span>, ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#eqiv. manyglm()</span></span>
<span><span class="co"># fit copula ordination </span></span>
<span><span class="va">spid_gr</span><span class="op">=</span><span class="fu"><a href="../reference/cgr.html">cgr</a></span><span class="op">(</span><span class="va">spider_nb</span>, seed<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># biplot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spid_gr</span>, pad<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecoCopula_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Graphs are interpreted as maps of direct and indirect associations
between taxa.</p>
<ul>
<li><p>taxa pairs that have no direct edge between them (e.g Pardmont
and Trocterr) have no direct association, so any co-occurrence patterns
they have are due to associations they both have with other taxa in the
data (mediator species, e.g. Alopcune).</p></li>
<li><p>taxa with direct edges between them have positive associations
(blue; e.g. Alopacce and Alopfabr), or negative associations (pink; none
found) even after controlling for mediation effects of all the other
taxa in the data.</p></li>
</ul>
<p>One interpretation is that taxa with direct edges are interacting,
though this can only be a hypothesis, as there may be unobserved taxa or
environmental variables which could be causing the apparent interaction.
The main objective of this analysis is to visualise relationships in
order to generate hypotheses to be experimentally tested.</p>
<p>To check that we fit a sensible model we can plot residuals
<code>plot(spider_nb)</code>. For fancier plots with <code>ggplot</code>
and <code>igraph</code> see <code><a href="../reference/plot.cgr.html">?plot.cgr</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="bryce-canyon-vegetation-ordinal-cover">Bryce Canyon vegetation ordinal cover<a class="anchor" aria-label="anchor" href="#bryce-canyon-vegetation-ordinal-cover"></a>
</h2>
<p>These data contain estimates of cover class for all non-tree vascular
plant species in 160 375m^2 circular sample plots and associated
environmental variables in Bryce Canyon National Park, Utah, U.S.A.
Species codes are first three letters of genus then first three letters
of specific epithet. We can download the data from the
<code>labdsv</code> package, it is in two parts <code>brycesite</code>
gives the site data and <code>bryceveg</code> the cover data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">labdsv</span><span class="op">)</span></span>
<span><span class="co"># site data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">brycesite</span><span class="op">)</span></span>
<span><span class="va">brycesite</span><span class="op">$</span><span class="va">plotcode</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">brycesite</span><span class="op">$</span><span class="va">plotcode</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#species data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bryceveg</span><span class="op">)</span></span>
<span><span class="va">bryceveg</span><span class="op">&lt;-</span> <span class="va">bryceveg</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">bryceveg</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span><span class="op">]</span>  <span class="co">#most abundant species</span></span></code></pre></div>
<p>To model ordinal data in <code>stackedsdm</code> we need the
categories to be integers starting at 1.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#recode data to integer categories</span></span>
<span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span> <span class="co">#existing categories</span></span>
<span><span class="va">bryceord</span><span class="op">=</span><span class="va">bryceveg</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">bryceord</span><span class="op">[</span><span class="va">bryceveg</span><span class="op">==</span><span class="va">old</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">=</span><span class="va">i</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#marginal model</span></span>
<span><span class="va">bryce_marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedsdm.html">stackedsdm</a></span><span class="op">(</span><span class="va">bryceord</span>, formula_X <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">brycesite</span>, family<span class="op">=</span><span class="st">"ordinal"</span>,ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="ordination-1">Ordination<a class="anchor" aria-label="anchor" href="#ordination-1"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bryce_ordi</span><span class="op">=</span><span class="fu"><a href="../reference/cord.html">cord</a></span><span class="op">(</span><span class="va">bryce_marg</span><span class="op">)</span></span></code></pre></div>
<p>We plot the ordinations with <code>ggplot</code>, colouring sites by
elevation gradient. If we had traits we could color species by
traits.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># data frames for plotting</span></span>
<span><span class="va">site_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">bryce_ordi</span><span class="op">$</span><span class="va">scores</span>,<span class="va">brycesite</span><span class="op">)</span></span>
<span><span class="va">sp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">bryce_ordi</span><span class="op">$</span><span class="va">loadings</span>,</span>
<span>                     species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bryceord</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">alpha</span><span class="op">=</span> <span class="fl">2.5</span> <span class="co"># scaling parameter</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Factor1</span>,y<span class="op">=</span><span class="va">Factor2</span>,color <span class="op">=</span> <span class="va">elev</span> <span class="op">)</span>,<span class="va">site_res</span><span class="op">)</span><span class="op">+</span> <span class="co">#sites</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Factor1</span><span class="op">*</span><span class="va">alpha</span>, y <span class="op">=</span> <span class="va">Factor2</span><span class="op">*</span><span class="va">alpha</span>,label <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,data<span class="op">=</span><span class="va">sp_res</span><span class="op">)</span><span class="op">+</span> <span class="co">#species</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, name <span class="op">=</span> <span class="st">"PuOr"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecoCopula_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Low elevation and high elevation sites have quite different species,
with low elevations associated with e.g. cermon, and high elevation with
e.g. pacmyr.</p>
</div>
<div class="section level3">
<h3 id="graphical-model-of-veg-species">Graphical model of veg species<a class="anchor" aria-label="anchor" href="#graphical-model-of-veg-species"></a>
</h3>
<p>We will control for slope.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cont_preds</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">brycesite</span>, <span class="va">class</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"int"</span>,<span class="st">"num"</span><span class="op">)</span></span>
<span><span class="va">brycesite</span><span class="op">[</span>,<span class="va">cont_preds</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">brycesite</span><span class="op">[</span>,<span class="va">cont_preds</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bryce_marg_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackedsdm.html">stackedsdm</a></span><span class="op">(</span><span class="va">bryceord</span>, formula_X <span class="op">=</span> <span class="op">~</span> <span class="va">slope</span>, data <span class="op">=</span> <span class="va">brycesite</span>,</span>
<span>                             family<span class="op">=</span><span class="st">"ordinal"</span>,ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bryce_graph</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/cgr.html">cgr</a></span><span class="op">(</span><span class="va">bryce_marg_all</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#seed for demonstration</span></span></code></pre></div>
<p>For more detailed plots <code>cgr</code> has an igraph output, which
you can manipulate and plot with the <code>tidygraph</code> and
<code>ggraph</code> packages as well as the <code>igraph</code>
package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">igraph_out</span><span class="op">&lt;-</span><span class="va">bryce_graph</span><span class="op">$</span><span class="va">best_graph</span><span class="op">$</span><span class="va">igraph_out</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com" class="external-link">ggraph</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">igraph_out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html" class="external-link">ggraph</a></span><span class="op">(</span><span class="st">'fr'</span><span class="op">)</span> <span class="op">+</span> <span class="co"># see ?layout_tbl_graph_igraph</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_fan.html" class="external-link">geom_edge_fan0</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span> colour <span class="op">=</span> <span class="va">partcor</span>, width<span class="op">=</span><span class="va">partcor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_width.html" class="external-link">scale_edge_width</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_colour.html" class="external-link">scale_edge_color_gradient2</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"#b2182b"</span>,mid<span class="op">=</span><span class="st">"white"</span>,high<span class="op">=</span><span class="st">"#2166ac"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html" class="external-link">geom_node_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">name</span><span class="op">)</span>, repel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html" class="external-link">geom_node_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="ecoCopula_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;">
There is a strong positive association between e.g. ceamar and arcpat
after controlling for all the other species.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-ecocopula-functionality-and-notes">Other ecoCopula functionality and notes<a class="anchor" aria-label="anchor" href="#other-ecocopula-functionality-and-notes"></a>
</h2>
<ul>
<li><p><code>stackedsdm</code> can take a vector of families, this means
each column can have a different distribution. This is most often useful
when modelling traits rather than abundance (some of which are binary,
and some continuous), but could also be useful if you have abundance
data collected differently for different taxa (some presence/absence,
some counts, some ordinal)</p></li>
<li><p>Residual ordination: by including predictors in the
<code>stackedsdm</code> or <code>manyglm</code> model, you are
controlling for these. Any ordination you will control for the effect of
these variables. This might make it easier to see the effect of other
variables.</p></li>
<li><p>It is not uncommon for <code>cgr</code> to output a graph with no
edges. The final model you plot is the <em>best</em> model chosen by
BIC. With a small amount of data this is often a model with no
associations. The models are indexed by the shrinkage parameter
<code>lambda</code>, and given graphical modelling is exploratory, you
can further explore different models by changing lambda manually. You
can find the shrinkage parameter for the best model with
<code>cgr_fit$all_graphs$lambda.opt</code> where cgr_fit is your fitted
<code>cgr</code> object. Smaller values of lambda give more dense graphs
with more edges. You can then fit a model with a smaller lambda with the
<code>lambda</code> argument in <code>cgr</code>.</p></li>
<li><p>Both <code>cord</code> and <code>cgr</code> have a
<code>n.samp</code> argument. If you find different runs of these
functions give different results, try increasing
<code>n.samp</code>.</p></li>
</ul>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Aart, P. J. M. van der &amp; N. Smeenk-Enserink 1975. Correlations
between distributions of hunting spiders (Lycosidae, Ctenidae) and
environmental characteristics in a dune area. Neth. J. Zool, 25,
1-45.</p>
<p>Popovic, G. C., Hui, F. K., &amp; Warton, D. I. (2018). <a href="https://doi.org/10.1016/j.jmva.2017.12.002" class="external-link">A general algorithm
for covariance modeling of discrete data</a>. Journal of Multivariate
Analysis, 165, 86-100.</p>
<p>Popovic, G. C., Warton, D. I., Thomson, F. J., Hui, F. K., &amp;
Moles, A. T. (2019). <a href="https://doi.org/10.1111/2041-210X.13247" class="external-link">Untangling direct species
associations from indirect mediator species effects with graphical
models</a>. Methods in Ecology and Evolution, 10(9), 1571-1583.</p>
<p>Roberts D.W. (1992): <a href="https://www.davidzeleny.net/anadat-r/doku.php/en:data:bryce" class="external-link">Plant
Community Distribution and Dynamics in Bryce Canyon National Park</a>:
Final Report for Project PX 1200-7-0966</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gordana Popovic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
